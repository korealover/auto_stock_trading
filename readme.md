# 한국투자증권 오픈API 자동매매 프로그램

한국투자증권 오픈API를 활용한 Python 기반 자동매매 시스템입니다. 기술적 분석을 통한 매수/매도 신호 생성과 자동 주문 실행 기능을 제공합니다.

## 📋 목차

- [주요 기능](#주요-기능)
- [시스템 구조](#시스템-구조)
- [설치 및 설정](#설치-및-설정)
- [사용법](#사용법)
- [매매 전략](#매매-전략)
- [주의사항](#주의사항)
- [문제해결](#문제해결)

## ✨ 주요 기능

### 🔌 API 연동 기능
- 한국투자증권 오픈API 실시간 데이터 조회
- OAuth2 토큰 자동 관리
- 실투자/모의투자 환경 지원
- 연결 안정성을 위한 재시도 로직

### 📊 시장 데이터 분석
- 실시간 주가 및 거래량 조회
- 차트 데이터 수집 (일봉/주봉/월봉)
- 기술적 지표 계산 (이동평균, RSI)
- 거래량 분석

### 🤖 자동매매 전략
- 골든크로스/데드크로스 기반 매매
- RSI 과매수/과매도 신호 활용
- 거래량 증가 패턴 감지
- 손절/익절 자동 실행

### 📈 포트폴리오 관리
- 실시간 잔고 및 보유종목 조회
- 포지션 크기 자동 계산
- 최대 보유종목 수 제한
- 투자비율 관리

## 🏗️ 시스템 구조
├── main.py # 메인 실행 스크립트 
├── api.py # 한국투자증권 API 연동 클래스 
├── strategy.py # 자동매매 전략 로직 
├── config.json # 설정 파일 (자동 생성) 
└── trading.log # 거래 로그 파일

### 핵심 클래스

#### `KISOpenAPI` (api.py)
- 한국투자증권 오픈API와의 통신 담당
- 토큰 관리, 주문 실행, 데이터 조회 기능

#### `AutoTradingStrategy` (strategy.py)
- 매매 전략 로직 구현
- 기술적 분석 및 신호 생성
- 포트폴리오 관리

## 🚀 설치 및 설정

### 1. 환경 요구사항
- Python 3.8+ uv (패키지 관리자)

### 2. 패키지 설치

```bash
# 필수 패키지 설치
uv add requests pandas numpy schedule pytz
```
### 3. API 키 발급
1. [한국투자증권 오픈API](https://apiportal.koreainvestment.com) 접속
2. 회원가입 및 앱 등록
3. APP KEY, APP SECRET 발급
4. 모의투자 계좌 개설 (테스트용)

### 4. 설정 파일 구성
프로그램 첫 실행 시 `config.json` 파일이 자동 생성됩니다.
```bash 
{
    "api_credentials": {
        "app_key": "YOUR_APP_KEY",
        "app_secret": "YOUR_APP_SECRET",
        "account_no": "12345678-01",
        "is_real": false
    },
    "trading_config": {
        "watchlist": ["005930", "000660", "035420"],
        "max_position_count": 5,
        "max_invest_ratio": 0.8,
        "stop_loss_ratio": 0.05,
        "take_profit_ratio": 0.1
    }
}
```
**설정 옵션 설명:**
- `is_real`: false(모의투자), true(실투자)
- : 최대 보유 종목 수 `max_position_count`
- : 최대 투자 비율 (80%) `max_invest_ratio`
- : 손절 비율 (5%) `stop_loss_ratio`
- : 익절 비율 (10%) `take_profit_ratio`

## 📱 사용법
### 기본 실행
```bash
uv run main.py
```

### 실행 모드
프로그램 실행 후 다음 4가지 모드를 선택할 수 있습니다:
1. **한 번 실행**: 즉시 매매 전략 실행
2. **자동 스케줄 실행**: 5분마다 자동 실행 (장시간 중)
3. **포트폴리오 현황 조회**: 현재 보유종목과 수익률 확인
4. **종목 분석**: 특정 종목의 기술적 분석 결과 조회

### 추가 유틸리티 함수
```
# API 연결 테스트
test_api_connection()

# 시장 상태 확인
get_market_status()

# 관심종목 모니터링
monitor_watchlist()
```

## 📊 매매 전략
### 매수 조건 (4개 중 3개 이상 만족)
1. **골든크로스**: 5일 이동평균선이 20일 이동평균선 위에 위치
2. **RSI 신호**: RSI가 30~70 범위 (과매도에서 벗어남)
3. **거래량 증가**: 평균 거래량의 1.5배 이상
4. **제한적 하락**: 당일 하락률이 3% 이내

### 매도 조건 (하나라도 만족)
1. **손절**: 5% 이상 손실
2. **익절**: 10% 이상 수익
3. **데드크로스**: 5일선이 20일선 아래로 하락
4. **과매수**: RSI 80 이상

### 포지션 관리
- **분산투자**: 최대 5개 종목 동시 보유
- **자금관리**: 가용자금의 80%만 투자
- **균등분할**: 각 종목당 동일한 비중 투자

## ⚠️ 주의사항
### 🔴 투자 위험 경고
``` 
⚠️  이 프로그램은 교육 목적으로 제작되었습니다.
⚠️  실제 투자에는 원금 손실의 위험이 있습니다.
⚠️  충분한 테스트 없이 실투자 사용을 금지합니다.
```
### 📋 사용 전 체크리스트
- [ ] 모의투자로 충분한 테스트 완료
- [ ] 투자 가능한 여유자금으로만 시작
- [ ] 시장 상황에 따른 전략 수정 계획 수립
- [ ] 정기적인 로그 모니터링 방안 마련

### 🕐 장시간 제한
- **장시간**: 평일 09:00 ~ 15:30
- **장외시간**: 매매 전략 실행 중단
- **주말/공휴일**: 시스템 자동 대기

### 📝 로그 관리
모든 거래 내역은 `trading.log` 파일에 기록됩니다:
``` 
2024-01-15 09:30:15 - INFO - 매수 주문 성공: 005930, 수량: 10
2024-01-15 14:25:33 - INFO - 매도 주문 성공: 000660, 수량: 5, 손익: +15,000원
```
## 🔧 문제해결
### 연결 오류 해결
**문제**: `ConnectTimeoutError` 발생
``` 
HTTPSConnectionPool: Max retries exceeded
```
**해결방법**:
1. 인터넷 연결 상태 확인
2. 방화벽에서 9443, 29443 포트 허용
3. VPN 사용 시 일시적 해제
4. DNS 설정을 Google DNS(8.8.8.8)로 변경

### API 인증 오류
**문제**: 토큰 발급 실패
``` 
토큰 발급 실패: 401
```
**해결방법**:
1. APP KEY, APP SECRET 재확인
2. 계좌번호 형식 확인 (XXXXXXXX-XX)
3. API 서비스 신청 상태 확인
4. 모의투자 계좌 개설 여부 확인

### 주문 실패 해결
**문제**: 매수/매도 주문 실패
**해결방법**:
1. 장시간 여부 확인
2. 보유 현금 부족 여부 확인
3. 주문 가능 시간대 확인
4. 종목코드 정확성 확인

## 📞 지원 및 문의
- **한국투자증권 고객센터**: 1544-5000
- **오픈API 문의**: API 포털 내 문의 게시판
- **시스템 오류**: GitHub Issues 등록

## 📄 라이선스
이 프로젝트는 교육 목적으로 제작되었으며, MIT 라이선스를 따릅니다.
**면책조항**: 본 프로그램 사용으로 인한 투자 손실에 대해 개발자는 책임을 지지 않습니다. 투자는 본인의 판단과 책임 하에 수행해주시기 바랍니다.
